# 信用云开放API简介

## 平台简介 



## API 域名

| 环境     | 域名                                    | 说明            |
| -------- | --------------------------------------- | --------------- |
| 生产环境 | http://paas-api-cc.prod.chinacsci.com |  |
| 测试环境 | http://paas-api-cc.dev.chinacsci.com    | 开发调试使用    |



## 开始接入

### 开发测试流程

Step 1. 申请信用云开发者账号,具体可联系客服进行账号申请;

Step 2. 获取测试环境 apiKey & secret ;

Step 3. 利用文档和开发者工具测试接口;

Step 4. 完成接口测试后进行相应开发;

Step 5. 完成后发布上线。

### 如何获取 apiKey 和 secret

用户登录到开发者中心，在个人信息中可以获取开发者秘钥信息

```html
apiKey: (第三方app-key，是三方开发者系统的唯一标示)
secret: (第三方开发人员调用信用云openapi时用于计算签名的参数.请妥善保管)
```

### 客户端工具
[credit-client](https://github.com/ben19891128/credit-client)


## 编码

编码统一都采用 `UTF-8`

默认数据传输都采用JSON格式,请求Header中设置content-type为`application/json;charset=utf-8`

如有特殊要求具体接口文档会标明.



## 接口返回报文

第三方开发人员需判断http的响应码，如下：

```
200表示调用成功
500，502表示系统内部错误，可稍后再试
401表示未授权
403表示签名验证失败
400表示业务处理错误.
```

如果接口没有特殊说明，接口统一返回格式如下：

```json
{
    "code": "CM10000",//返回错误码
    "errorMessage": null,//错误信息
    "data": "pass",//返回数据
    "success": true //请求是否成功.
}
```

字段说明:

| 字段名称     | 类型    | 字段说明                                                     |
| ------------ | ------- | ------------------------------------------------------------ |
| code         | String  | [错误码](#error-code) 列表                                   |
| errorMessage | String  | 错误描述信息                                                 |
| data         | Object  | 返回结果，接口的具体返回值请参阅Api详细说明                  |
| success      | Boolean | 接口执行结果，为true表示执行成功，此时data值返回结果数据; 为false表示执行失败，此时code返回具体的错误码，errorMessage返回具体的错误信息 |



## 系统参数

系统参数指和具体的业务无关，但是每次接口调用都需要的输入参数，系统参数通过http请求的header传入，系统参数如下：

| 字段名称 | 类型   | 字段说明                                                     |
| -------- | ------ | ------------------------------------------------------------ |
| apiKey   | String | 开发者秘钥                                                   |
| timstamp | Number | 接口调用时的时间戳，即当前时间戳（时间戳：当前距离Epoch（1970年1月1日) 以秒计算的时间，即unix-timestamp. 请求过期时间为5分钟. |
| sign     | String | 输入参数的签名结果，签名方法请参考[计算签名](#cal-sign)      |



## <span id='cal-sign'>计算签名</span>

以个人征信反欺诈接口为例。

### 排序

对除sign外的系统参数和所有请求参数进行排序

**文档中url{}带问号（如{?status}）为请求参数，要参与排序**

将url的所有**请求参数**以及除sign外的**系统参数**按照**字母序**进行排序（如果参数包含中文，中文保持原文即可，无需对其单独转码），并使用&连接， 请求body不参与排序。见如下实例：

```html
请求url为：
/api/v1/mirror/anti-fraud/001
系统参数有:
timestamp:1540523883713
apiKey: ntjhb0v6thrwaujqttytbzayow5ozw

则参与排序的参数如下：
timestamp=1540523883713
apiKey=ntjhb0v6thrwaujqttytbzayow5ozw
排序连接后的结果为 apiKey=ntjhb0v6thrwaujqttytbzayow5ozw&timestamp=1540523883713
```

### 拼接

 使用QueryString的格式（即key1=value1&key2=value2…）拼接字符串

```html
url路径为 /api/v1/mirror/anti-fraud/001
和上述排序后的结果拼接后为 /api/v1/mirror/anti-fraud/001?apiKey=ntjhb0v6thrwaujqttytbzayow5ozwd&timestamp=1540523883713
```

连接secret的值在最末尾，至此为签名字符串

```html
假设secret=m2i5oddjmgzhmgi0ndk2m2jhytjkmznjmzdhymfkmwq
拼接之后的结果为 /api/v1/mirror/anti-fraud/001?apiKey=ntjhb0v6thrwaujqttytbzayow5ozw&timestamp=1540523883713m2i5oddjmgzhmgi0ndk2m2jhytjkmznjmzdhymfkmwq
```



### MD5计算签名

```html
上述字符串的MD5签名结果为 
bfccab9443775ecfa6dcba1207ba8457
```

### 完整请求

```shell
$ curl -X POST \
  http://{{host}}/api/v1/mirror/anti-fraud/001 \
  -H 'Content-Type: application/json' \
  -H 'apiKey: ntjhb0v6thrwaujqttytbzayow5ozw' \
  -H 'sign: bfccab9443775ecfa6dcba1207ba8457' \
  -H 'timestamp: 1540523883713' \
  -d '{"idNo":"341225198906274952","name":"马化腾","mobile":"15618579663","org_name":"腾通讯"}'
```



## <span id='error-code'>错误码</span>

### 通用错误码

| 错误代码(code) | 含义                                      |
| -------------- | ----------------------------------------- |
| CM10000        | 请求成功.                                 |
| CM10001        | 请求参数无效                              |
| CM10003        | 日期格式错误.yyyy-MM-dd                   |
| CM10004        | 服务器异常,请稍后再试，如有疑问请联系客服 |
| CM10005        | 请求头必选包含apiKey,timestamp,sign信息   |
| CM19999        | 未知的错误                                |
| AU20001        | 验证签名不通过                            |
| AU20002        | 权限校验不通过                            |
| AU20003        | 请求已经过期                              |

### 个人征信错误码

| 错误码(code) | 含义                                                         |
| ------------ | ------------------------------------------------------------ |
| MI30001      | 参数不正确                                                   |
| MI30004      | 无权访问该服务                                               |
| MI30005      | 评分失败                                                     |
| MI39998      | Hystrix.个人征信(cloud-mirror)服务器异常,请稍后再试.触发熔断返回此错误码 |
| MI39999      | 其他错误                                                     |

### 企业征信错误码

| 错误码(code) | 含义                                                         |
| ------------ | ------------------------------------------------------------ |
| ME40001      | 参数不正确                                                   |
| ME40002      | 客户不存在                                                   |
| ME40004      | 资源无法找到                                                 |
| ME40005      | 无对应产品                                                   |
| ME40008      | 该请求已经过期                                               |
| ME40009      | 内部服务错误                                                 |
| ME49998      | Hystrix,企业征信(cloud-mercury)服务器异常,请稍后再试.触发熔断返回此错误码 |
| ME49999      | 未知的错误                                                   |



### 区块链错误码

| 错误码(code) | 含义                                       |
| ------------ | ------------------------------------------ |
| CP30001      | 资产已经在链上                             |
| CP30002      | 资产不存在链上                             |
| CP30003      | 数据缓存失败                               |
| CP30004      | 资产交易已经在链上                         |
| CP30005      | credio plush:服务器内部错误.               |
| CP30006      | 角色不存在                                 |
| CP30007      | 用户角色不存在                             |
| CP30008      | 授权中心验证密码不正确                     |
| CP30009      | 用户角色信息不存在                         |
| CP30010      | credio plush:用户中心内部错误.             |
| CP30011      | ⽤户中⼼无法找到该用户                     |
| CP30012      | 用户未激活                                 |
| CP30013      | 用户中心验证密码不正确                     |
| CP30014      | 授权中心⽆法找到该用户                     |
| CP30015      | 两次输⼊密码不一样                         |
| CP30016      | app已存在                                  |
| CP30017      | 用户不在该区块链组织中                     |
| CP30018      | 区块链组织已存在                           |
| CP30019      | 用户企业已存在                             |
| CP30020      | 用户企业不存在                             |
| CP30021      | ⽤户所在企业的区块链组织不匹配，⽆法加入   |
| CP30022      | 户与查询对象不在同一个区块链组织           |
| CP30023      | 企业类型信息不存在                         |
| CP30024      | ⽤户已经被注销                             |
| CP30025      | 操作⽤户与被注销用户不属于同⼀个区块链组织 |
| CP30026      | 不能注销当前登录用户                       |
| CP30027      | ⽤户已经为激活状态                         |
| CP30028      | 区块链组织不存在                           |
| CP30029      | 添加订阅失败, 未找到相应区块链节点         |
| CP30030      | 订阅⽆法添加，可能已经存在                 |
| CP30031      | 订阅无法取消,可能不存在                    |
| CP30032      | 订阅服务无法获取相应信道ID信息             |
| CP30033      | 订阅服务无法获取相应信道详情               |
| CP30034      | 订阅服务无法获取相应信道节点详情           |
| CP30035      | 查询输入参数错误                           |
| CP30036      | 交易记录未找到                             |
| CP30037      | 交易记录无效                               |
| CP30038      | 未知交易记录格式                           |
| CP30039      | 区块链节点不存在                           |
| CP30040      | ⽤户业务组无节点部署或安装产品智能合约     |
| CP30041      | 调用方法让与智能合约描述文件不匹配         |
| CP30042      | 智能合约描述文件无效                       |
| CP30043      | 查询区块链结果为空                         |
| CP30044      | 参数校验失败                               |
| CP30045      | 产品不存在                                 |
| CP39998      | credio plush:服务器内部错误                |
| CP39999      | 未知的错误                                 |



## 更新日志

| 更新时间 | 更新内容 | 备注 |
| -------- | -------- | ---- |
|          |          |      |



## 常见问题

**Q1:apiKey和secret会改变吗？**

apiKey和secret是开发者在创建账号的时候按照一定的规则生成,目前系统不支持变更，所以不会改变.请开发者妥善保管好秘钥。



## 联系我们-Contact Us

paas.support@chinacsci.com